// --- マップデータ定義 (Ver 5.0 No-Door & Gimmick Edition) ---
const maps = {
    // ----------------------------------------------------
    // 1. 地下迷宮 (構造: 基本的な部屋と回廊の迷路)
    // ----------------------------------------------------
    1: {
        1: [ // B1F: スタート(1,1) -> 探索して右下(18,18)の下り階段へ
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,9,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,5,1], 
            [1,0,1,0,1,0,1,1,1,1,1,1,1,1,1,0,0,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,1],
            [1,0,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,0,1],
            [1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,1],
            [1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], 
            [1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,1,1,0,0,1],
            [1,0,0,0,1,0,1,5,1,0,1,0,1,0,0,0,0,0,0,1],
            [1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,1,1,1,1,1],
            [1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], 
            [1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1],
            [1,0,0,0,0,0,1,0,0,0,1,0,1,5,1,0,1,0,0,1],
            [1,0,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,0,1],
            [1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1], 
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ],
        2: [ // B2F: 中央に大きな部屋、四隅に小部屋
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,2,0,0,1,0,0,0,0,0,0,0,0,0,0,1,5,0,0,1], 
            [1,0,0,0,1,0,1,1,1,1,1,1,1,1,0,1,0,0,0,1],
            [1,0,1,1,1,0,1,0,0,0,0,0,0,1,0,1,1,1,0,1],
            [1,0,1,5,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1],
            [1,0,1,1,1,0,1,0,1,1,1,1,0,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,1,0,1,0,0,1,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,1], 
            [1,0,1,1,1,0,1,0,0,0,0,0,0,1,0,1,1,1,0,1],
            [1,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1], 
            [1,0,1,1,1,0,1,0,0,0,0,0,0,1,0,1,1,1,0,1],
            [1,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1],
            [1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1],
            [1,0,0,0,1,1,1,1,1,0,0,1,1,1,1,1,5,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,0,1],
            [1,0,0,0,0,0,1,5,0,0,0,0,0,1,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,1], 
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ],
        3: [ // B3F: ボスフロア (左上からスタート、右下ボス)
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,6,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], 
            [1,1,1,1,1,1,1,0,1,1,0,1,0,1,1,1,1,1,0,1],
            [1,5,0,0,0,0,1,0,1,5,0,1,0,1,5,0,0,0,0,1], 
            [1,1,1,1,1,0,1,0,1,1,1,1,0,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,1,0,1,0,1],
            [1,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,1,0,1],
            [1,0,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], 
            [1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1],
            [1,0,1,5,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1],
            [1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,0,1], 
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ]
    },

    // ----------------------------------------------------
    // 2. 迷いの森 (構造: 開けた空間とループ)
    // ----------------------------------------------------
    2: {
        1: [ // 1F: 開けた森。右下を目指す。
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,5,1], 
            [1,0,1,1,0,1,1,0,1,0,1,1,1,1,1,0,0,1,0,1],
            [1,0,1,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,1,5,0,1,0,1,0,0,0,0,0,1], 
            [1,0,0,0,0,0,0,0,1,0,0,1,0,1,0,0,0,0,0,1],
            [1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,1,1,1,1,1],
            [1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1],
            [1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,5,0,1],
            [1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1],
            [1,1,1,1,0,1,1,1,1,0,1,1,1,1,0,1,1,0,1,1],
            [1,5,0,1,0,0,0,0,1,0,1,5,0,1,0,0,0,0,0,1],
            [1,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,2,1], 
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ],
        2: [ // 2F: 大きなループ構造
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1], 
            [1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1],
            [1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1],
            [1,0,1,0,1,1,1,1,0,1,1,1,1,0,1,1,1,1,0,1],
            [1,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1],
            [1,0,1,0,1,0,1,1,1,1,1,0,1,1,1,1,0,1,0,1],
            [1,0,1,0,1,0,1,5,0,0,1,0,1,0,0,0,0,1,0,1],
            [1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,1],
            [1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1], 
            [1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1],
            [1,0,1,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,0,1],
            [1,0,0,0,0,0,0,1,0,1,0,0,0,0,1,0,1,5,0,1],
            [1,0,0,0,0,0,0,1,0,1,0,0,0,0,1,0,1,1,1,1],
            [1,0,1,1,1,1,0,1,0,1,0,1,1,0,1,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,6,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ],
        3: [ // 3F: ボスエリア
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1], 
            [1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1],
            [1,0,1,5,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1],
            [1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,0,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1],
            [1,0,1,5,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,0,1,1,0,1,0,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,1,3,1,0,0,0,0,0,0,0,0,1], 
            [1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ]
    },

    // ----------------------------------------------------
    // 3. 海底洞窟 (ギミック: 流水 7)
    // ----------------------------------------------------
    3: {
        1: [ // 1F: 水流で行けない場所を迂回する
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,9,0,0,0,7,7,7,0,0,0,0,0,0,0,0,0,0,0,1], 
            [1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,1,0,1,0,1,5,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,0,1,0,1,0,1,1,1,1,1,1,1,1,0,1,0,1],
            [1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,1,0,1,5,0,0,0,1,0,1], 
            [1,1,1,1,1,7,7,7,1,0,1,0,1,1,1,1,1,1,0,1], 
            [1,5,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,7,7,7,1,1,1,1,1,1,1,1,0,1], 
            [1,0,1,5,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,1,1,1],
            [1,0,0,0,1,0,1,0,1,0,0,0,1,5,0,0,0,0,0,1],
            [1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1], 
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ],
        2: [ // 2F: 大きな水流パズル。流されると戻される。
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,2,0,0,0,0,0,1,5,0,0,0,0,0,0,0,0,0,0,1], 
            [1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,1], 
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], 
            [1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,1], 
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], 
            [1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1],
            [1,5,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,5,0,1],
            [1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,1], 
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ],
        3: [ // 3F: ボスエリア
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], 
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1],
            [1,0,1,5,0,0,0,0,0,0,0,0,0,0,0,1,5,0,0,1],
            [1,0,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,1,0,1,0,1],
            [1,0,1,0,1,3,1,0,0,0,0,0,0,0,0,1,0,1,0,1], 
            [1,0,1,0,1,0,1,0,1,1,1,1,1,1,0,1,0,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ]
    },

    // ----------------------------------------------------
    // 4. 古代神殿 (ギミック: ワープ 8)
    // ----------------------------------------------------
    4: {
        1: [ // 1F: 飛び地をワープで進む
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,9,0,0,0,0,0,1,0,0,0,0,0,8,1,5,0,0,8,1], 
            [1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,1,1,1,1,1,0,1,0,1,1,1,1,1,0,1,0,1],
            [1,0,1,5,0,0,8,1,0,1,0,1,5,0,0,1,0,1,0,1], 
            [1,0,1,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1],
            [1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1],
            [1,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1],
            [1,0,1,0,1,5,0,0,0,0,0,0,0,1,0,1,0,1,0,1],
            [1,0,1,0,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1],
            [1,0,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1],
            [1,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1],
            [1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1],
            [1,8,0,0,0,0,8,1,0,1,8,1,0,1,0,1,8,1,2,1], 
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ],
        2: [ // 2F: ワープで区切られた4つのエリア
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,2,0,0,1,0,0,0,0,0,1,5,0,0,0,0,0,0,0,1], 
            [1,1,1,0,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1],
            [1,5,1,0,1,0,1,8,1,0,1,8,0,0,0,0,1,0,0,1], 
            [1,0,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,1,0,1],
            [1,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,1],
            [1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,1,1,1,1,1,0,1,0,1,1,1,1,1,0,1,0,1],
            [1,0,1,5,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1],
            [1,0,1,1,1,1,0,1,0,1,0,1,0,8,0,1,0,1,0,1], 
            [1,0,0,0,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1],
            [1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,0,0,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,8,1,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,1], 
            [1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ],
        3: [ // 3F: ボスエリア
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], 
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1],
            [1,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1],
            [1,0,1,0,1,5,0,0,0,0,0,0,0,1,0,1,0,1,0,1],
            [1,0,1,0,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1],
            [1,0,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1],
            [1,0,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,1,0,1],
            [1,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1],
            [1,0,0,0,0,0,0,1,0,1,0,1,0,1,1,1,1,1,1,1],
            [1,0,1,1,1,1,0,1,0,1,0,1,0,0,0,0,0,0,0,1],
            [1,0,1,3,1,1,0,1,0,1,0,1,1,1,1,1,1,1,0,1], 
            [1,0,1,0,1,1,0,1,0,1,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,0,0,0,0,1,0,1,1,1,1,1,1,1,0,1,0,1],
            [1,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ]
    },

    // ----------------------------------------------------
    // 5. 天空の塔 (ギミック: 落とし穴 4)
    // ----------------------------------------------------
    5: {
        1: [ // 1F: 穴はないが、2Fから落ちてくる場所がある
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], 
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,0,1],
            [1,0,1,5,0,0,1,0,1,0,0,0,0,0,0,1,0,1,0,1],
            [1,0,1,1,1,0,1,0,1,0,1,1,1,1,0,1,0,1,0,1],
            [1,0,0,0,0,0,1,0,1,0,1,5,0,1,0,1,0,1,0,1],
            [1,1,1,1,1,1,1,0,1,0,1,1,0,1,0,1,0,1,0,1],
            [1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,1,0,1], 
            [1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1],
            [1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1],
            [1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1], 
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ],
        2: [ // 2F: 落とし穴エリア。落ちると1Fへ。
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], 
            [1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,4,0,4,0,4,0,1,1,1,0,4,0,4,0,4,0,0,1], 
            [1,0,0,0,0,0,0,0,1,5,1,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,4,1,1,1,1,1,1,0,1,1,1,1,1,1,1,4,0,1], 
            [1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],
            [1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1],
            [1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1],
            [1,0,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,1],
            [1,1,1,1,0,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ],
        3: [ // 3F: ボスエリア
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], 
            [1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,1,0,1],
            [1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,1],
            [1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,1,0,1,0,1],
            [1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1],
            [1,0,1,0,1,0,1,1,1,0,1,1,1,1,0,1,0,1,0,1],
            [1,0,1,0,1,0,1,3,0,0,0,0,0,1,0,1,0,1,0,1], 
            [1,0,1,0,1,0,1,1,1,1,1,1,1,1,0,1,0,1,0,1],
            [1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1],
            [1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1],
            [1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
            [1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ]
    }
};

// --- ギミックデータ (Map座標に対応) ---
const gimmickData = {
    // ------------------------------------
    // 3. 海底洞窟 (Flow: 流水)
    // ------------------------------------
    // B1F
    "3_1_5_1": {type:'flow', dx:1, dy:0}, "3_1_6_1": {type:'flow', dx:1, dy:0}, "3_1_7_1": {type:'flow', dx:1, dy:0},
    "3_1_5_8": {type:'flow', dx:1, dy:0}, "3_1_6_8": {type:'flow', dx:1, dy:0}, "3_1_7_8": {type:'flow', dx:1, dy:0},
    "3_1_7_12": {type:'flow', dx:1, dy:0}, "3_1_8_12": {type:'flow', dx:1, dy:0}, "3_1_9_12": {type:'flow', dx:1, dy:0},
    
    // B2F
    "3_2_2_4": {type:'flow', dx:1, dy:0}, "3_2_3_4": {type:'flow', dx:1, dy:0}, "3_2_4_4": {type:'flow', dx:1, dy:0}, "3_2_5_4": {type:'flow', dx:1, dy:0}, "3_2_6_4": {type:'flow', dx:1, dy:0}, "3_2_7_4": {type:'flow', dx:1, dy:0}, "3_2_8_4": {type:'flow', dx:1, dy:0}, "3_2_9_4": {type:'flow', dx:1, dy:0}, "3_2_10_4": {type:'flow', dx:1, dy:0}, "3_2_11_4": {type:'flow', dx:1, dy:0}, "3_2_12_4": {type:'flow', dx:1, dy:0}, "3_2_13_4": {type:'flow', dx:1, dy:0}, "3_2_14_4": {type:'flow', dx:1, dy:0}, "3_2_15_4": {type:'flow', dx:1, dy:0}, "3_2_16_4": {type:'flow', dx:1, dy:0}, "3_2_17_4": {type:'flow', dx:1, dy:0},
    "3_2_2_8": {type:'flow', dx:1, dy:0}, "3_2_3_8": {type:'flow', dx:1, dy:0}, "3_2_4_8": {type:'flow', dx:1, dy:0}, "3_2_5_8": {type:'flow', dx:1, dy:0}, "3_2_6_8": {type:'flow', dx:1, dy:0}, "3_2_7_8": {type:'flow', dx:1, dy:0}, "3_2_8_8": {type:'flow', dx:1, dy:0}, "3_2_9_8": {type:'flow', dx:1, dy:0}, "3_2_10_8": {type:'flow', dx:1, dy:0}, "3_2_11_8": {type:'flow', dx:1, dy:0}, "3_2_12_8": {type:'flow', dx:1, dy:0}, "3_2_13_8": {type:'flow', dx:1, dy:0}, "3_2_14_8": {type:'flow', dx:1, dy:0}, "3_2_15_8": {type:'flow', dx:1, dy:0}, "3_2_16_8": {type:'flow', dx:1, dy:0}, "3_2_17_8": {type:'flow', dx:1, dy:0},

    // ------------------------------------
    // 4. 古代神殿 (Warp: ワープ)
    // ------------------------------------
    // B1F
    "4_1_13_1": {type:'warp', tx:1, ty:17}, // スタート付近から南東エリアへ
    "4_1_6_5": {type:'warp', tx:1, ty:8},  // 北西の部屋から西側通路へ
    "4_1_1_17": {type:'warp', tx:13, ty:1},  // 南西隅から北側通路へ
    "4_1_6_17": {type:'warp', tx:10, ty:17},  // 南西隅から北側通路へ
    "4_1_16_17": {type:'warp', tx:18, ty:1},  // 南西隅から北側通路へ



    // B2F
    "4_2_7_3": {type:'warp', tx:16, ty:16}, // 北西エリア -> 南東エリア
    "4_2_11_3": {type:'warp', tx:3, ty:16}, // 北東エリア -> 南西エリア
    "4_2_13_12": {type:'warp', tx:3, ty:3}, // 中央エリア -> 北西エリア
    "4_2_2_16": {type:'warp', tx:11, ty:3}, // 南西エリア -> 北東エリア
    "4_2_16_16": {type:'warp', tx:7, ty:3}, // 南東エリア -> 北西エリア

    // ------------------------------------
    // 5. 天空の塔 (Hole: 落とし穴)
    // ------------------------------------
    // B2F (穴がある場所)
    // 穴データは game.js のロジック (tile === TILE.HOLE) で自動処理されるため、
    // ここに座標定義は不要ですが、特殊な挙動をさせたい場合は記述します。
    // 今回は標準動作（下の階の同じ座標へ落下）を利用します。
};